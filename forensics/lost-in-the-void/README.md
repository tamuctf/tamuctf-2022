# Lost in the Void
## Description
Help! I've lost my private key somehow, and I need you to--

Okay, look, I was going to make a meaningful and CTF-y story for this challenge, but the scenario really wasn't making sense. You just need to decrypt enc.bin. Here's the source code we used to generate the challenge and a memory dump; good luck!
## Solution
Use https://github.com/ZetaTwo/prime-finder to find `p` and `q` within the core file. Based on the provided source, we know the modulus is 4096 bits, so each prime will be 2048 bits = 256 bytes.

```
$ prime-finder ./core.4179 --null-filter-length 2 --prime-size 256`
04:40:54 [INFO] Finding candidate primes
06:18:47 [INFO] Found 102 prime candidates
06:18:47 [INFO] Construct N candidates
██████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████ 10404/10404
06:18:47 [INFO] Search for composites in file
Validated primes in file
P:29199685339097057468513705418044841624361179778604233204817384701135536245449429752668120935668937071045984438005118304177345256872256621510992044288766298543080694432470414783917145187070862826336431702497814709740982259858664587750443564808641718207290388573252351749782650565813470873093817001277089453070155228247993998274958225770223732841420754946850548768187859416573568512182825540092736130817779020853049611873949260113910982431708486402521243301872008787297676824765493844910311382622002185159438668297826555648576591278784673786023445838911646133501742220951461152933244800380345849110223601626500488179327 Q:30413834203247325805296450897477294420446671645651599010665338227749678336368605701268368735151204451603978587110330754877037396658689882914098751862087768362248756925292653247162414207880192735019530353238433701117698441820478003003308692355947567599396261678223262546612019717019132689810334580140798914033760550456691842502179949759600433066284130613086714411198961632530607117741154992835972721338102588143822434266549884232608282740242522071930664993721179837824855272945303327092480890505096191106156700452438197330234772830595819795627890900555450019935097619966092275641691518679620659881451341784621092587783 N:888074388690289575263433880053959950676515871655825453972893048299514148502775635496097723572800404484724135643181395013210585529072469378299420275795193605725651661442526722413069071870687322026797056280511555995337869698583534084317921120507816687789697241583458530706497174989258948413223427694818630606213540512364487044178874340263677261965471875003375297753870209629635520277281721947152311030084405082323002511967683952054703878082201477302212437064783970274713395676420809163246406858105784346997494637164442372251043093201034901217061838650783529367941798614627558005799990664461255431013228214324806216183682158379226364255515957014164001415862421789706618560535078068948334426065370998877707803179497311574658446042547995439282114276019407628853508296151165856457208872765199725938364324296890751470167798995832978727673490177948666850586603098549568906276924061346456616538260978137781771906949054357813544165171347157139993406329093815439677034105366280588947104857620051200411124246592822502580067019501393803835639193131430691041279644858712704780668935368666930014032982566731865913918741040890326586686238330337797222253520905572640587308960783029549689341297947638112435514786920662257259227781036132979008593362041
P:29199685339097057468513705418044841624361179778604233204817384701135536245449429752668120935668937071045984438005118304177345256872256621510992044288766298543080694432470414783917145187070862826336431702497814709740982259858664587750443564808641718207290388573252351749782650565813470873093817001277089453070155228247993998274958225770223732841420754946850548768187859416573568512182825540092736130817779020853049611873949260113910982431708486402521243301872008787297676824765493844910311382622002185159438668297826555648576591278784673786023445838911646133501742220951461152933244800380345849110223601626500488179327 Q:30413834203247325805296450897477294420446671645651599010665338227749678336368605701268368735151204451603978587110330754877037396658689882914098751862087768362248756925292653247162414207880192735019530353238433701117698441820478003003308692355947567599396261678223262546612019717019132689810334580140798914033760550456691842502179949759600433066284130613086714411198961632530607117741154992835972721338102588143822434266549884232608282740242522071930664993721179837824855272945303327092480890505096191106156700452438197330234772830595819795627890900555450019935097619966092275641691518679620659881451341784621092587783 N:888074388690289575263433880053959950676515871655825453972893048299514148502775635496097723572800404484724135643181395013210585529072469378299420275795193605725651661442526722413069071870687322026797056280511555995337869698583534084317921120507816687789697241583458530706497174989258948413223427694818630606213540512364487044178874340263677261965471875003375297753870209629635520277281721947152311030084405082323002511967683952054703878082201477302212437064783970274713395676420809163246406858105784346997494637164442372251043093201034901217061838650783529367941798614627558005799990664461255431013228214324806216183682158379226364255515957014164001415862421789706618560535078068948334426065370998877707803179497311574658446042547995439282114276019407628853508296151165856457208872765199725938364324296890751470167798995832978727673490177948666850586603098549568906276924061346456616538260978137781771906949054357813544165171347157139993406329093815439677034105366280588947104857620051200411124246592822502580067019501393803835639193131430691041279644858712704780668935368666930014032982566731865913918741040890326586686238330337797222253520905572640587308960783029549689341297947638112435514786920662257259227781036132979008593362041
```

While there are 2 candidate pairs, they're the same because the private key was probably copied around. 

Now, we need to find the public exponent. Looking at the `rsa` crate's source code, we see that the [default value](https://docs.rs/rsa/latest/src/rsa/algorithms.rs.html#14) for `e` is 65537. Since we already know `p` and `q`, it's easy to recover `d`. Finally, we decrypt with the same padding scheme listed in the original source code, and we get a flag!
```rust
static P: &str = "29199685339097057468513705418044841624361179778604233204817384701135536245449429752668120935668937071045984438005118304177345256872256621510992044288766298543080694432470414783917145187070862826336431702497814709740982259858664587750443564808641718207290388573252351749782650565813470873093817001277089453070155228247993998274958225770223732841420754946850548768187859416573568512182825540092736130817779020853049611873949260113910982431708486402521243301872008787297676824765493844910311382622002185159438668297826555648576591278784673786023445838911646133501742220951461152933244800380345849110223601626500488179327";
static Q: &str = "30413834203247325805296450897477294420446671645651599010665338227749678336368605701268368735151204451603978587110330754877037396658689882914098751862087768362248756925292653247162414207880192735019530353238433701117698441820478003003308692355947567599396261678223262546612019717019132689810334580140798914033760550456691842502179949759600433066284130613086714411198961632530607117741154992835972721338102588143822434266549884232608282740242522071930664993721179837824855272945303327092480890505096191106156700452438197330234772830595819795627890900555450019935097619966092275641691518679620659881451341784621092587783";

static N: &str = "888074388690289575263433880053959950676515871655825453972893048299514148502775635496097723572800404484724135643181395013210585529072469378299420275795193605725651661442526722413069071870687322026797056280511555995337869698583534084317921120507816687789697241583458530706497174989258948413223427694818630606213540512364487044178874340263677261965471875003375297753870209629635520277281721947152311030084405082323002511967683952054703878082201477302212437064783970274713395676420809163246406858105784346997494637164442372251043093201034901217061838650783529367941798614627558005799990664461255431013228214324806216183682158379226364255515957014164001415862421789706618560535078068948334426065370998877707803179497311574658446042547995439282114276019407628853508296151165856457208872765199725938364324296890751470167798995832978727673490177948666850586603098549568906276924061346456616538260978137781771906949054357813544165171347157139993406329093815439677034105366280588947104857620051200411124246592822502580067019501393803835639193131430691041279644858712704780668935368666930014032982566731865913918741040890326586686238330337797222253520905572640587308960783029549689341297947638112435514786920662257259227781036132979008593362041";

use rsa::{RsaPrivateKey, PaddingScheme};
use num_bigint_dig::{ModInverse, BigUint};
use num_traits::*;

fn main() {
    let p = BigUint::parse_bytes(P.as_bytes(), 10).unwrap();
    let q = BigUint::parse_bytes(Q.as_bytes(), 10).unwrap();
    let n = BigUint::parse_bytes(N.as_bytes(), 10).unwrap();
    let one = &BigUint::one();
    let phi = (p.clone() - one) * (q.clone() - one);
    let e = BigUint::parse_bytes("65537".as_bytes(), 10).unwrap();
    let d = e.clone().mod_inverse(phi).unwrap().to_biguint().unwrap();
    let key = RsaPrivateKey::from_components(n, e, d, vec![p, q]);
    let c = include_bytes!("../enc.bin");
    let flag = key.decrypt(PaddingScheme::PKCS1v15Encrypt, c.as_slice()).unwrap();
    println!("{}", std::str::from_utf8(&flag).unwrap());
}
```
Flag: `gigem{a_familiar_treasure_hunt}`
